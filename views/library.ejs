<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>
<body>
    <%- include('./partials/header.ejs') %>
    <div class="library-body">
        <input type="checkbox" id="check">
        <label for="check" class="btn1"><i class="fa-solid fa-bars"></i></label>
        <div class="library-left">
            <div class="library-left-top">
                <a href="/"><i class="fa-solid fa-house"></i></a>
                <label for="check" class="btn2"><i class="fa-solid fa-x"></i></label>
            </div>
            <div class="library-left-bottom">
                <a href="/" id="home-link"><i class="fa-solid fa-house"></i>    <p>Home</p></a>
                <hr>
                <a href="#library-regist"><i class="fa-solid fa-user-plus"></i> <p>Regist</p></a>
                <a href="#library-books"><i class="fa-solid fa-book"></i> <p>Books</p></a>
                <a href="#library-add"><i class="fa-solid fa-download"></i> <p>Import</p></a>
                <a href="#library-users"><i class="fa-solid fa-users"></i> <p>Users</p></a>
            </div>

        </div>
        <div class="library-right">
            <div id="library-books">
                <% books.forEach((book) => { %>
                    <a href="/library/book/<%=book.book_id%>">
                        <div class="book">
                            <p><%=book.book_name[0].toUpperCase().concat(book.book_name.slice(1,))%></p>
                            <div><i class="fa-solid fa-book-open"></i></div>
                            <h6>View</h6>
                        </div>  
                    </a>     
                <% }) %>
            </div>
            <div id="library-add">
                <h3>ADD BOOK</h3>
                <div class="form1">
                    <input type="text" id="bookname" placeholder="Enter book name...">
                    <button onclick="handleClick()">Search</button>
                </div>

                <div id="mybooks" >Want to import books? Search for book</div>
            </div>
            <div id="library-regist">
                <h3>MEMBERSHIP</h3>
                <form action="/addMember" method="post">
                    <label for="userFname">Enter First Name</label>
                    <input type="text" name="userFname">
                    <label for="userLname">Enter Last Name</label>
                    <input type="text" name="userLname">
                    <label for="userEmail">Enter Valid Email</label>
                    <input type="text" name="userEmail">
                    <label for="userId">Enter National ID</label>
                    <input type="text" name="userId">
                    <button>UPDATE</button>
                </form>
            </div>
            <div id="library-users">
                <h2>MEMBERS</h2>
                <form action="/searchUser" method="post">
                    <input type="text" placeholder="search" name="userid">
                    <button>SEARCH</button>
                </form>
                <div class="library-users-div">
                    <%
                     members.forEach((member) => { %>
                        <a href="/library/user/<%=member.member_id%>">
                                <p><%=member.member_fname[0].toUpperCase().concat(member.member_fname.slice(1,)) %> <%=member.member_lname[0].toUpperCase().concat(member.member_lname.slice(1,))%> <i class="fa-solid fa-arrow-right-long"></i></p>
                        </a>     
                    <% }) %>
                </div>

            </div>
        </div>
    </div>
    <script>

        function handleClick() {

            let bookName = document.getElementById('bookname').value;
            let myBook = document.getElementById('mybooks');
            myBook.innerHTML = 'Searching... ensure you are connected to the internet! Also, be patient... wacha ichukue time yake';
            fetch(`https://openlibrary.org/search.json?q=${bookName}&limit=4`)
            .then(response => response.json())
            .then((data) => {
                const booksArray = [];
                console.log(data);
                data.docs.forEach((book) => {
                    booksArray.push(
                        [`
                            <div>
                                <form action='/addBook' method='post'>
                                <input  hidden type='text' name='bKey' value='${book.key === undefined ? 'key0' : book.key.split('').splice(7,).join('')}' />
                                <input  type='text' name='bName' value='${book.title.replace("'","&lsquo;")}' />
                                <input  type='text' name='author' value='${book.author_name === undefined ? 'Author0' : book.author_name}' />
                                <input  hidden type='text' name='lang' value='${book.language === undefined ? 'language0' : book.language.splice(4)}' />
                                <input  hidden type='number' name='pages' value='${book.number_of_pages_median === undefined ? 0 : book.number_of_pages_median}' />
                                <input  hidden type='number' name='year' value='${book.first_publish_year === undefined ? 0 : book.first_publish_year}' />
                                <input  hidden type='text' name='publisher' value='${book.publisher === undefined ? 'publisher0' : book.publisher[0]}' />
                                <button>ADD</button>
                                </form>
                            </div>`
                        ]
                    )
                });
                // console.log(booksArray);
            myBook.innerHTML = booksArray.map((book) => {
                return book;
            }).join('');
            }).catch((err) => {
                console.log(err);
            })
        }

    </script>
</body>
</html>